<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Tri·∫øt h·ªçc M√°c‚ÄìL√™nin</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #c41e3a;
      --bg: #ffffff;
      --text: #111111;
      --muted: #6b7280;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: "Inter", system-ui;
      padding: 20px;
    }
    .app {
      display: grid;
      grid-template-columns: 340px 1fr;
      max-width: 1300px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    @media(max-width: 900px) { .app { grid-template-columns: 1fr; } }

    .left {
      border-right: 1px solid #eee;
      padding: 20px;
      background: #fafafa;
    }
    .left h2 {
      font-family: "Merriweather", serif;
      color: var(--accent);
    }
    .topic {
      background: #fff;
      border-left: 4px solid var(--accent);
      padding: 10px 12px;
      margin: 8px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .topic:hover {
      background: #fff3f3;
      transform: scale(1.01);
    }

    .right {
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    .view {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      background: #fff;
    }
    .msg {
      margin: 10px 0;
      display: flex;
    }
    .msg.user {
      justify-content: flex-end;
    }
    .msg.ai {
      justify-content: flex-start;
    }
    .bubble {
      padding: 12px 14px;
      border-radius: 12px;
      line-height: 1.6;
      max-width: 80%;
      white-space: pre-line;
      font-size: 15px;
    }
    .msg.user .bubble {
      background: #fef2f2;
      border: 1px solid #f5c2c2;
      color: #111;
    }
    .msg.ai .bubble {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      color: #111;
    }
    .input-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }
    textarea {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      resize: none;
      font-family: inherit;
      font-size: 15px;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      cursor: pointer;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="left">
      <h2>Tri·∫øt h·ªçc M√°c‚ÄìL√™nin</h2>
      <p style="font-size:14px;color:#555;">Ch·ªçn ch·ªß ƒë·ªÅ ho·∫∑c ƒë·∫∑t c√¢u h·ªèi b·∫•t k·ª≥ ƒë·ªÉ AI ph√¢n t√≠ch theo phong c√°ch h·ªçc thu·∫≠t, bi·ªán ch·ª©ng.</p>
      <div id="topics"></div>
    </div>

    <div class="right">
      <div class="view" id="view">
        <div class="msg ai">
          <div class="bubble">Xin ch√†o! üëã T√¥i l√† AI Tri·∫øt h·ªçc M√°c‚ÄìL√™nin. B·∫°n c√≥ th·ªÉ h·ªèi t√¥i v·ªÅ gi√° tr·ªã th·∫∑ng d∆∞, t√≠ch l≈©y t∆∞ b·∫£n, h√¨nh th·ª©c bi·ªÉu hi·ªán ho·∫∑c th·ª±c ti·ªÖn Vi·ªát Nam.</div>
        </div>
      </div>
      <div class="input-row">
        <textarea id="user-input" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..."></textarea>
        <button id="send">G·ª≠i</button>
      </div>
    </div>
  </div>

<script>
const KNOWLEDGE_BASE = {
  "3.1": {
    title: "3.1 L√Ω lu·∫≠n c·ªßa C. M√°c v·ªÅ gi√° tr·ªã th·∫∑ng d∆∞",
    text: `
üìò **Kh√°i ni·ªám:**  
Gi√° tr·ªã th·∫∑ng d∆∞ (GTTD) l√† ph·∫ßn gi√° tr·ªã m·ªõi do ng∆∞·ªùi lao ƒë·ªông t·∫°o ra v∆∞·ª£t qu√° gi√° tr·ªã s·ª©c lao ƒë·ªông ‚Äì ph·∫ßn n√†y b·ªã nh√† t∆∞ b·∫£n chi·∫øm ƒëo·∫°t.

üîπ **C·∫•u tr√∫c gi√° tr·ªã h√†ng ho√°:**  
W = c + v + m  
- c: t∆∞ b·∫£n b·∫•t bi·∫øn (t∆∞ li·ªáu s·∫£n xu·∫•t)  
- v: t∆∞ b·∫£n kh·∫£ bi·∫øn (s·ª©c lao ƒë·ªông)  
- m: gi√° tr·ªã th·∫∑ng d∆∞ (lao ƒë·ªông kh√¥ng c√¥ng)

üîπ **Th·ªùi gian lao ƒë·ªông:**  
- Th·ªùi gian t·∫•t y·∫øu (t): t·∫°o gi√° tr·ªã b·∫±ng ti·ªÅn l∆∞∆°ng  
- Th·ªùi gian th·∫∑ng d∆∞ (t‚Äô): t·∫°o gi√° tr·ªã th·∫∑ng d∆∞  
‚Üí T·ª∑ su·∫•t GTTD:  m' = (t‚Äô / t) √ó 100%

üîπ **B·∫£n ch·∫•t:**  
GTTD kh√¥ng do t∆∞ b·∫£n sinh ra m√† do **lao ƒë·ªông s·ªëng** t·∫°o ra. S·ª©c lao ƒë·ªông l√† **h√†ng ho√° ƒë·∫∑c bi·ªát** ‚Äì gi√° tr·ªã s·ª≠ d·ª•ng c·ªßa n√≥ t·∫°o ra **gi√° tr·ªã l·ªõn h∆°n b·∫£n th√¢n n√≥**.

üîπ **√ù nghƒ©a:**  
L√Ω lu·∫≠n v·ªÅ GTTD l√† h√≤n ƒë√° t·∫£ng c·ªßa h·ªçc thuy·∫øt kinh t·∫ø ch√≠nh tr·ªã M√°c, gi√∫p v·∫°ch r√µ b·∫£n ch·∫•t b√≥c l·ªôt trong ch·ªß nghƒ©a t∆∞ b·∫£n.`
  },

  "3.1.3": {
    title: "3.1.3 C√°c ph∆∞∆°ng ph√°p s·∫£n xu·∫•t gi√° tr·ªã th·∫∑ng d∆∞",
    text: `
üîπ **1. Gi√° tr·ªã th·∫∑ng d∆∞ tuy·ªát ƒë·ªëi (Absolute Surplus Value):**  
üëâ L√† ph·∫ßn GTTD thu ƒë∆∞·ª£c do **k√©o d√†i ng√†y lao ƒë·ªông** v∆∞·ª£t qu√° th·ªùi gian t·∫•t y·∫øu, trong khi nƒÉng su·∫•t lao ƒë·ªông v√† gi√° tr·ªã s·ª©c lao ƒë·ªông kh√¥ng ƒë·ªïi.  

V√≠ d·ª•: Ng√†y lao ƒë·ªông 8h g·ªìm 4h t·∫•t y·∫øu + 4h th·∫∑ng d∆∞ ‚Üí m' = 100%.  
N·∫øu k√©o d√†i th√™m 2h (t·ªïng 10h), ph·∫ßn th·∫∑ng d∆∞ = 6h ‚Üí m' = (6/4)√ó100% = **150%**.  

üîπ **2. Gi√° tr·ªã th·∫∑ng d∆∞ t∆∞∆°ng ƒë·ªëi (Relative Surplus Value):**  
üëâ L√† GTTD thu ƒë∆∞·ª£c b·∫±ng c√°ch **r√∫t ng·∫Øn th·ªùi gian t·∫•t y·∫øu** nh·ªù tƒÉng nƒÉng su·∫•t lao ƒë·ªông, l√†m ph·∫ßn th·∫∑ng d∆∞ tƒÉng l√™n **d√π t·ªïng th·ªùi gian kh√¥ng ƒë·ªïi**.  
‚Üí Gi·∫£m gi√° tr·ªã s·ª©c lao ƒë·ªông b·∫±ng c√°ch h·∫° gi√° t∆∞ li·ªáu sinh ho·∫°t.  

üîπ **3. Gi√° tr·ªã th·∫∑ng d∆∞ si√™u ng·∫°ch (Super Surplus Value):**  
üëâ Xu·∫•t hi·ªán khi m·ªôt s·ªë doanh nghi·ªáp c√≥ **gi√° tr·ªã c√° bi·ªát th·∫•p h∆°n gi√° tr·ªã x√£ h·ªôi**, nh·ªù √°p d·ª•ng k·ªπ thu·∫≠t ti√™n ti·∫øn.  
‚Üí Ph·∫ßn ch√™nh l·ªách ƒë√≥ l√† **GTTD si√™u ng·∫°ch**, ƒë·ªông l·ª±c th√∫c ƒë·∫©y ƒë·ªïi m·ªõi k·ªπ thu·∫≠t.`
  },

  "3.2": {
    title: "3.2 T√≠ch l≈©y t∆∞ b·∫£n (Capital Accumulation)",
    text: `
üìò **B·∫£n ch·∫•t:**  
T√≠ch l≈©y t∆∞ b·∫£n l√† qu√° tr√¨nh **chuy·ªÉn m·ªôt ph·∫ßn gi√° tr·ªã th·∫∑ng d∆∞ (m)** th√†nh **t∆∞ b·∫£n ph·ª• th√™m**, m·ªü r·ªông quy m√¥ s·∫£n xu·∫•t.  
ƒê√¢y l√† h√¨nh th·ª©c **t√°i s·∫£n xu·∫•t m·ªü r·ªông** c·ªßa ch·ªß nghƒ©a t∆∞ b·∫£n.

üîπ **C√¥ng th·ª©c:** ŒîC = m √ó a  
(a l√† t·ª∑ l·ªá t√°i ƒë·∫ßu t∆∞ gi√° tr·ªã th·∫∑ng d∆∞)

üîπ **Nh√¢n t·ªë ·∫£nh h∆∞·ªüng quy m√¥ t√≠ch l≈©y:**  
1Ô∏è‚É£ T·ª∑ su·∫•t gi√° tr·ªã th·∫∑ng d∆∞ (m‚Äô): c√†ng cao ‚Üí t√≠ch l≈©y c√†ng l·ªõn.  
2Ô∏è‚É£ NƒÉng su·∫•t lao ƒë·ªông x√£ h·ªôi: tƒÉng nƒÉng su·∫•t ‚Üí gi·∫£m gi√° tr·ªã s·ª©c lao ƒë·ªông ‚Üí tƒÉng m.  
3Ô∏è‚É£ Quy m√¥ t∆∞ b·∫£n ·ª©ng tr∆∞·ªõc: v·ªën c√†ng l·ªõn ‚Üí kh·∫£ nƒÉng t√≠ch l≈©y c√†ng cao.  
4Ô∏è‚É£ Hi·ªáu qu·∫£ s·ª≠ d·ª•ng m√°y m√≥c v√† k·ªπ thu·∫≠t.

üîπ **H·ªá qu·∫£:**  
- **TƒÉng c·∫•u t·∫°o h·ªØu c∆° c·ªßa t∆∞ b·∫£n (c/v)** ‚Üí m√°y m√≥c nhi·ªÅu h∆°n lao ƒë·ªông.  
- **T√≠ch t·ª• v√† t·∫≠p trung t∆∞ b·∫£n** ‚Üí h√¨nh th√†nh doanh nghi·ªáp l·ªõn.  
- **Ph√¢n h√≥a x√£ h·ªôi** ‚Üí t∆∞ b·∫£n gi√†u l√™n, lao ƒë·ªông ngh√®o ƒëi.`
  },

  "3.3": {
    title: "3.3 C√°c h√¨nh th·ª©c bi·ªÉu hi·ªán c·ªßa gi√° tr·ªã th·∫∑ng d∆∞",
    text: `
üìò Trong kinh t·∫ø th·ªã tr∆∞·ªùng, GTTD (m) bi·ªÉu hi·ªán d∆∞·ªõi c√°c **h√¨nh th√°i c·ª• th·ªÉ**:

üîπ **1. L·ª£i nhu·∫≠n (p):**  
L√† ph·∫ßn ch√™nh l·ªách gi·ªØa **gi√° tr·ªã h√†ng h√≥a (G)** v√† **chi ph√≠ s·∫£n xu·∫•t (k)**.  
‚Üí V·ªÅ b·∫£n ch·∫•t, *p = m*, nh∆∞ng ƒë√£ b·ªã che gi·∫•u.  
C√¥ng th·ª©c:  
- k = c + v  
- p‚Äô = (p / (c + v)) √ó 100%  ‚Üí t·ª∑ su·∫•t l·ª£i nhu·∫≠n.  

üîπ **2. L·ª£i t·ª©c (Z):**  
L√† **m·ªôt ph·∫ßn l·ª£i nhu·∫≠n b√¨nh qu√¢n** m√† ng∆∞·ªùi ƒëi vay tr·∫£ cho ng∆∞·ªùi cho vay v·ªën.  
C√¥ng th·ª©c: Z‚Äô = (Z / TBCV) √ó 100%  

üîπ **3. ƒê·ªãa t√¥ t∆∞ b·∫£n ch·ªß nghƒ©a (R):**  
L√† **ph·∫ßn gi√° tr·ªã th·∫∑ng d∆∞ c√≤n l·∫°i sau khi tr·ª´ l·ª£i nhu·∫≠n b√¨nh qu√¢n**, do nh√† t∆∞ b·∫£n n√¥ng nghi·ªáp tr·∫£ cho ƒë·ªãa ch·ªß.  
G·ªìm:  
- ƒê·ªãa t√¥ ch√™nh l·ªách I (ƒë·∫•t t·ªët h∆°n)  
- ƒê·ªãa t√¥ ch√™nh l·ªách II (ƒë·∫ßu t∆∞ th√¢m canh)  
- ƒê·ªãa t√¥ tuy·ªát ƒë·ªëi (t·ªìn t·∫°i ngay c·∫£ tr√™n ƒë·∫•t x·∫•u)  
üí∞ Gi√° ƒë·∫•t = ƒê·ªãa t√¥ / T·ª∑ su·∫•t l·ª£i t·ª©c`
  },

  "vietnam": {
    title: "Th·ª±c ti·ªÖn t·∫°i Vi·ªát Nam",
    text: `
üáªüá≥ **1. Gi√° tr·ªã th·∫∑ng d∆∞ trong khu v·ª±c FDI:**  
C√¥ng nh√¢n trong c√°c t·∫≠p ƒëo√†n nh∆∞ Samsung, Foxconn t·∫°o ra gi√° tr·ªã g·∫•p **4‚Äì5 l·∫ßn ti·ªÅn l∆∞∆°ng**.  
‚Üí H√¨nh th·ª©c **GTTD tuy·ªát ƒë·ªëi & t∆∞∆°ng ƒë·ªëi** r√µ n√©t trong to√†n c·∫ßu h√≥a.

üáªüá≥ **2. T√≠ch l≈©y t∆∞ b·∫£n trong kinh t·∫ø th·ªã tr∆∞·ªùng ƒë·ªãnh h∆∞·ªõng XHCN:**  
Doanh nghi·ªáp t√°i ƒë·∫ßu t∆∞ l·ª£i nhu·∫≠n ‚Üí **tƒÉng t√≠ch l≈©y n·ªôi b·ªô**, g√≥p ph·∫ßn c√¥ng nghi·ªáp h√≥a.  
Tuy nhi√™n, c≈©ng l√†m gia tƒÉng **b·∫•t b√¨nh ƒë·∫≥ng thu nh·∫≠p** v√† **t·∫≠p trung t∆∞ b·∫£n**.

üáªüá≥ **3. H√¨nh th·ª©c bi·ªÉu hi·ªán m·ªõi:**  
- L·ª£i nhu·∫≠n si√™u ng·∫°ch trong c√¥ng ngh·ªá (FPT, VNG).  
- ‚Äúƒê·ªãa t√¥ d·ªØ li·ªáu‚Äù, ‚Äúl·ª£i nhu·∫≠n n·ªÅn t·∫£ng‚Äù trong kinh t·∫ø s·ªë.  
- L·ª£i t·ª©c t√†i ch√≠nh, b·∫•t ƒë·ªông s·∫£n tƒÉng nhanh.

üáªüá≥ **4. ƒê·ªãnh h∆∞·ªõng ch√≠nh s√°ch:**  
- N√¢ng cao **gi√° tr·ªã s·ª©c lao ƒë·ªông** (ti·ªÅn l∆∞∆°ng, k·ªπ nƒÉng).  
- TƒÉng c∆∞·ªùng **ƒëi·ªÅu ti·∫øt qua thu·∫ø v√† an sinh x√£ h·ªôi**.  
- H∆∞·ªõng t·ªõi **ph√¢n ph·ªëi c√¥ng b·∫±ng, ph√°t tri·ªÉn b·ªÅn v·ªØng** theo ƒë·ªãnh h∆∞·ªõng XHCN.`
  }
};


function appendMessage(role, text) {
  const msg = document.createElement("div");
  msg.className = "msg " + role;
  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.innerHTML = text;
  msg.appendChild(bubble);
  document.getElementById("view").appendChild(msg);
  document.getElementById("view").scrollTop = 999999;
}

async function handleQuestion(q) {
  if (!q.trim()) return;
  appendMessage("user", q);
  document.getElementById("user-input").value = "";

  const lower = q.toLowerCase();
  const matched = Object.entries(KNOWLEDGE_BASE).find(([k, v]) => lower.includes(v.title.split(" ")[1].toLowerCase()));
  if (matched) {
    const [_, v] = matched;
    appendMessage("ai", `<strong>${v.title}</strong><br>${v.text.replace(/\n/g, "<br>")}`);
    return;
  }

  appendMessage("ai", "‚è≥ ƒêang ph√¢n t√≠ch s√¢u...");

  try {
  const res = await fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: q })
  });

  if (!res.ok) {
    const text = await res.text();
    throw new Error(`Server error: ${text}`);
  }

  const data = await res.json();
  appendMessage("ai", data.reply.replace(/\n/g, "<br>"));
} catch (err) {
  appendMessage("ai", "‚ö†Ô∏è L·ªói khi g·ªçi API: " + err.message);
}

}

// render topics
const topicsEl = document.getElementById("topics");
Object.values(KNOWLEDGE_BASE).forEach(v => {
  const el = document.createElement("div");
  el.className = "topic";
  el.innerHTML = `<strong>${v.title}</strong><br><span style="font-size:13px;color:#555;">${v.text.slice(0, 80)}...</span>`;
  el.onclick = () => appendMessage("ai", `<strong>${v.title}</strong><br>${v.text.replace(/\n/g, "<br>")}`);
  topicsEl.appendChild(el);
});

document.getElementById("send").addEventListener("click", () => handleQuestion(document.getElementById("user-input").value));
document.getElementById("user-input").addEventListener("keypress", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    handleQuestion(e.target.value);
  }
});
</script>
</body>
</html>
