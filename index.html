<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Triết học Mác–Lênin</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #c41e3a;
      --bg: #ffffff;
      --text: #111111;
      --muted: #6b7280;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: "Inter", system-ui;
      padding: 20px;
    }
    .app {
      display: grid;
      grid-template-columns: 340px 1fr;
      max-width: 1300px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    @media(max-width: 900px) { .app { grid-template-columns: 1fr; } }

    .left {
      border-right: 1px solid #eee;
      padding: 20px;
      background: #fafafa;
    }
    .left h2 {
      font-family: "Merriweather", serif;
      color: var(--accent);
    }
    .topic {
      background: #fff;
      border-left: 4px solid var(--accent);
      padding: 10px 12px;
      margin: 8px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .topic:hover {
      background: #fff3f3;
      transform: scale(1.01);
    }

    .right {
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    .view {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      background: #fff;
    }
    .msg {
      margin: 10px 0;
      display: flex;
    }
    .msg.user {
      justify-content: flex-end;
    }
    .msg.ai {
      justify-content: flex-start;
    }
    .bubble {
      padding: 12px 14px;
      border-radius: 12px;
      line-height: 1.6;
      max-width: 80%;
      white-space: pre-line;
      font-size: 15px;
    }
    .msg.user .bubble {
      background: #fef2f2;
      border: 1px solid #f5c2c2;
      color: #111;
    }
    .msg.ai .bubble {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      color: #111;
    }
    .input-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }
    textarea {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      resize: none;
      font-family: inherit;
      font-size: 15px;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      cursor: pointer;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="left">
      <h2>Triết học Mác–Lênin</h2>
      <p style="font-size:14px;color:#555;">Chọn chủ đề hoặc đặt câu hỏi bất kỳ để AI phân tích theo phong cách học thuật, biện chứng.</p>
      <div id="topics"></div>
    </div>

    <div class="right">
      <div class="view" id="view">
        <div class="msg ai">
          <div class="bubble">Xin chào! 👋 Tôi là AI Triết học Mác–Lênin. Bạn có thể hỏi tôi về giá trị thặng dư, tích lũy tư bản, hình thức biểu hiện hoặc thực tiễn Việt Nam.</div>
        </div>
      </div>
      <div class="input-row">
        <textarea id="user-input" placeholder="Nhập câu hỏi của bạn..."></textarea>
        <button id="send">Gửi</button>
      </div>
    </div>
  </div>

<script>
const KNOWLEDGE_BASE = {
  "3.1": {
    title: "3.1 Lý luận của C. Mác về giá trị thặng dư",
    text: `
📘 **Khái niệm:**  
Giá trị thặng dư (GTTD) là phần giá trị mới do người lao động tạo ra vượt quá giá trị sức lao động – phần này bị nhà tư bản chiếm đoạt.

🔹 **Cấu trúc giá trị hàng hoá:**  
W = c + v + m  
- c: tư bản bất biến (tư liệu sản xuất)  
- v: tư bản khả biến (sức lao động)  
- m: giá trị thặng dư (lao động không công)

🔹 **Thời gian lao động:**  
- Thời gian tất yếu (t): tạo giá trị bằng tiền lương  
- Thời gian thặng dư (t’): tạo giá trị thặng dư  
→ Tỷ suất GTTD:  m' = (t’ / t) × 100%

🔹 **Bản chất:**  
GTTD không do tư bản sinh ra mà do **lao động sống** tạo ra. Sức lao động là **hàng hoá đặc biệt** – giá trị sử dụng của nó tạo ra **giá trị lớn hơn bản thân nó**.

🔹 **Ý nghĩa:**  
Lý luận về GTTD là hòn đá tảng của học thuyết kinh tế chính trị Mác, giúp vạch rõ bản chất bóc lột trong chủ nghĩa tư bản.`
  },

  "3.1.3": {
    title: "3.1.3 Các phương pháp sản xuất giá trị thặng dư",
    text: `
🔹 **1. Giá trị thặng dư tuyệt đối (Absolute Surplus Value):**  
👉 Là phần GTTD thu được do **kéo dài ngày lao động** vượt quá thời gian tất yếu, trong khi năng suất lao động và giá trị sức lao động không đổi.  

Ví dụ: Ngày lao động 8h gồm 4h tất yếu + 4h thặng dư → m' = 100%.  
Nếu kéo dài thêm 2h (tổng 10h), phần thặng dư = 6h → m' = (6/4)×100% = **150%**.  

🔹 **2. Giá trị thặng dư tương đối (Relative Surplus Value):**  
👉 Là GTTD thu được bằng cách **rút ngắn thời gian tất yếu** nhờ tăng năng suất lao động, làm phần thặng dư tăng lên **dù tổng thời gian không đổi**.  
→ Giảm giá trị sức lao động bằng cách hạ giá tư liệu sinh hoạt.  

🔹 **3. Giá trị thặng dư siêu ngạch (Super Surplus Value):**  
👉 Xuất hiện khi một số doanh nghiệp có **giá trị cá biệt thấp hơn giá trị xã hội**, nhờ áp dụng kỹ thuật tiên tiến.  
→ Phần chênh lệch đó là **GTTD siêu ngạch**, động lực thúc đẩy đổi mới kỹ thuật.`
  },

  "3.2": {
    title: "3.2 Tích lũy tư bản (Capital Accumulation)",
    text: `
📘 **Bản chất:**  
Tích lũy tư bản là quá trình **chuyển một phần giá trị thặng dư (m)** thành **tư bản phụ thêm**, mở rộng quy mô sản xuất.  
Đây là hình thức **tái sản xuất mở rộng** của chủ nghĩa tư bản.

🔹 **Công thức:** ΔC = m × a  
(a là tỷ lệ tái đầu tư giá trị thặng dư)

🔹 **Nhân tố ảnh hưởng quy mô tích lũy:**  
1️⃣ Tỷ suất giá trị thặng dư (m’): càng cao → tích lũy càng lớn.  
2️⃣ Năng suất lao động xã hội: tăng năng suất → giảm giá trị sức lao động → tăng m.  
3️⃣ Quy mô tư bản ứng trước: vốn càng lớn → khả năng tích lũy càng cao.  
4️⃣ Hiệu quả sử dụng máy móc và kỹ thuật.

🔹 **Hệ quả:**  
- **Tăng cấu tạo hữu cơ của tư bản (c/v)** → máy móc nhiều hơn lao động.  
- **Tích tụ và tập trung tư bản** → hình thành doanh nghiệp lớn.  
- **Phân hóa xã hội** → tư bản giàu lên, lao động nghèo đi.`
  },

  "3.3": {
    title: "3.3 Các hình thức biểu hiện của giá trị thặng dư",
    text: `
📘 Trong kinh tế thị trường, GTTD (m) biểu hiện dưới các **hình thái cụ thể**:

🔹 **1. Lợi nhuận (p):**  
Là phần chênh lệch giữa **giá trị hàng hóa (G)** và **chi phí sản xuất (k)**.  
→ Về bản chất, *p = m*, nhưng đã bị che giấu.  
Công thức:  
- k = c + v  
- p’ = (p / (c + v)) × 100%  → tỷ suất lợi nhuận.  

🔹 **2. Lợi tức (Z):**  
Là **một phần lợi nhuận bình quân** mà người đi vay trả cho người cho vay vốn.  
Công thức: Z’ = (Z / TBCV) × 100%  

🔹 **3. Địa tô tư bản chủ nghĩa (R):**  
Là **phần giá trị thặng dư còn lại sau khi trừ lợi nhuận bình quân**, do nhà tư bản nông nghiệp trả cho địa chủ.  
Gồm:  
- Địa tô chênh lệch I (đất tốt hơn)  
- Địa tô chênh lệch II (đầu tư thâm canh)  
- Địa tô tuyệt đối (tồn tại ngay cả trên đất xấu)  
💰 Giá đất = Địa tô / Tỷ suất lợi tức`
  },

  "vietnam": {
    title: "Thực tiễn tại Việt Nam",
    text: `
🇻🇳 **1. Giá trị thặng dư trong khu vực FDI:**  
Công nhân trong các tập đoàn như Samsung, Foxconn tạo ra giá trị gấp **4–5 lần tiền lương**.  
→ Hình thức **GTTD tuyệt đối & tương đối** rõ nét trong toàn cầu hóa.

🇻🇳 **2. Tích lũy tư bản trong kinh tế thị trường định hướng XHCN:**  
Doanh nghiệp tái đầu tư lợi nhuận → **tăng tích lũy nội bộ**, góp phần công nghiệp hóa.  
Tuy nhiên, cũng làm gia tăng **bất bình đẳng thu nhập** và **tập trung tư bản**.

🇻🇳 **3. Hình thức biểu hiện mới:**  
- Lợi nhuận siêu ngạch trong công nghệ (FPT, VNG).  
- “Địa tô dữ liệu”, “lợi nhuận nền tảng” trong kinh tế số.  
- Lợi tức tài chính, bất động sản tăng nhanh.

🇻🇳 **4. Định hướng chính sách:**  
- Nâng cao **giá trị sức lao động** (tiền lương, kỹ năng).  
- Tăng cường **điều tiết qua thuế và an sinh xã hội**.  
- Hướng tới **phân phối công bằng, phát triển bền vững** theo định hướng XHCN.`
  }
};


function appendMessage(role, text) {
  const msg = document.createElement("div");
  msg.className = "msg " + role;
  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.innerHTML = text;
  msg.appendChild(bubble);
  document.getElementById("view").appendChild(msg);
  document.getElementById("view").scrollTop = 999999;
}

async function handleQuestion(q) {
  if (!q.trim()) return;
  appendMessage("user", q);
  document.getElementById("user-input").value = "";

  const lower = q.toLowerCase();
  const matched = Object.entries(KNOWLEDGE_BASE).find(([k, v]) => lower.includes(v.title.split(" ")[1].toLowerCase()));
  if (matched) {
    const [_, v] = matched;
    appendMessage("ai", `<strong>${v.title}</strong><br>${v.text.replace(/\n/g, "<br>")}`);
    return;
  }

  appendMessage("ai", "⏳ Đang phân tích sâu...");

  try {
  const res = await fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: q })
  });

  if (!res.ok) {
    const text = await res.text();
    throw new Error(`Server error: ${text}`);
  }

  const data = await res.json();
  appendMessage("ai", data.reply.replace(/\n/g, "<br>"));
} catch (err) {
  appendMessage("ai", "⚠️ Lỗi khi gọi API: " + err.message);
}

}

// render topics
const topicsEl = document.getElementById("topics");
Object.values(KNOWLEDGE_BASE).forEach(v => {
  const el = document.createElement("div");
  el.className = "topic";
  el.innerHTML = `<strong>${v.title}</strong><br><span style="font-size:13px;color:#555;">${v.text.slice(0, 80)}...</span>`;
  el.onclick = () => appendMessage("ai", `<strong>${v.title}</strong><br>${v.text.replace(/\n/g, "<br>")}`);
  topicsEl.appendChild(el);
});

document.getElementById("send").addEventListener("click", () => handleQuestion(document.getElementById("user-input").value));
document.getElementById("user-input").addEventListener("keypress", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    handleQuestion(e.target.value);
  }
});
</script>
</body>
</html>
