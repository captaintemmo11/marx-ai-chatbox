<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Triáº¿t há»c MÃ¡câ€“LÃªnin</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #ffffff;
      --muted: #6b7280;
      --primary: #111827;
      --accent: #c41e3a;
    }
    body {
      margin: 0; padding: 20px;
      font-family: 'Inter', system-ui;
      background: #f5f6f7; color: var(--primary);
    }
    .app {
      display: grid;
      grid-template-columns: 350px 1fr;
      max-width: 1300px;
      margin: auto;
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    @media(max-width:900px){ .app{grid-template-columns:1fr;} }

    .left { padding:20px; border-right:1px solid #eee; }
    .topic {
      background:#f9fafb;
      border-left:4px solid var(--accent);
      padding:10px;
      border-radius:8px;
      margin:10px 0;
      cursor:pointer;
    }
    .topic:hover { background:#fff3f3; }

    .right { padding:20px; display:flex; flex-direction:column; }

    .view {
      flex:1; overflow:auto;
      padding:10px;
      border:1px solid #eee;
      border-radius:10px;
      background:#fff;
    }
    .msg { margin:10px 0; display:flex; }
    .msg.user { justify-content:flex-end; }
    .msg.ai { justify-content:flex-start; }

    .bubble {
      padding:12px 14px;
      border-radius:12px;
      max-width:80%;
      line-height:1.5;
    }
    .msg.user .bubble {
      background: #fef2f2;
      color: #111;
      border:1px solid #f5c2c2;
    }
    .msg.ai .bubble {
      background:#f9fafb;
      border:1px solid #e5e7eb;
      color:#111;
    }

    textarea {
      flex:1; border:1px solid #ddd;
      border-radius:10px; padding:10px;
      resize:none; font-family:inherit;
    }
    button {
      background: var(--accent); color: white;
      border:none; border-radius:10px;
      padding:10px 16px; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="left">
      <h2 style="color:#c41e3a;font-family:Merriweather;">Triáº¿t há»c MÃ¡câ€“LÃªnin</h2>
      <p>Chá»n chá»§ Ä‘á» hoáº·c Ä‘áº·t cÃ¢u há»i báº¥t ká»³ Ä‘á»ƒ AI phÃ¢n tÃ­ch theo phong cÃ¡ch há»c thuáº­t.</p>
      <div id="topics"></div>
    </div>
    <div class="right">
      <div class="view" id="view">
        <div class="msg ai"><div class="bubble">Xin chÃ o! TÃ´i lÃ  AI Triáº¿t há»c. Báº¡n cÃ³ thá»ƒ há»i vá» giÃ¡ trá»‹ tháº·ng dÆ°, tÃ­ch lÅ©y tÆ° báº£n, hÃ¬nh thá»©c biá»ƒu hiá»‡n hoáº·c liÃªn há»‡ Viá»‡t Nam.</div></div>
      </div>
      <div style="margin-top:10px;display:flex;gap:10px;">
        <textarea id="user-input" placeholder="Nháº­p cÃ¢u há»i cá»§a báº¡n..."></textarea>
        <button id="send">Gá»­i</button>
      </div>
    </div>
  </div>

<script>
const OPENAI_API_KEY = const OPENAI_API_KEY = import.meta.env.VITE_OPENAI_API_KEY;

const KNOWLEDGE_BASE = {

  "3.1": {
    title: "3.1 LÃ½ luáº­n cá»§a C. MÃ¡c vá» giÃ¡ trá»‹ tháº·ng dÆ°",
    text: `
<strong>ğŸ”¹ KhÃ¡i niá»‡m:</strong><br>
GiÃ¡ trá»‹ tháº·ng dÆ° (GTTD) lÃ  pháº§n giÃ¡ trá»‹ má»›i mÃ  ngÆ°á»i lao Ä‘á»™ng táº¡o ra vÆ°á»£t quÃ¡ giÃ¡ trá»‹ sá»©c lao Ä‘á»™ng cá»§a há» â€” pháº§n nÃ y bá»‹ nhÃ  tÆ° báº£n chiáº¿m Ä‘oáº¡t khÃ´ng tráº£ cÃ´ng.<br><br>

<strong>ğŸ”¹ Cáº¥u trÃºc giÃ¡ trá»‹ hÃ ng hoÃ¡:</strong><br>
Theo C.MÃ¡c, giÃ¡ trá»‹ hÃ ng hÃ³a Ä‘Æ°á»£c cáº¥u thÃ nh bá»Ÿi:<br>
<em>GiÃ¡ trá»‹ hÃ ng hoÃ¡ (W) = c + v + m</em><br>
â€¢ <strong>c</strong> â€“ tÆ° báº£n báº¥t biáº¿n (constant capital): giÃ¡ trá»‹ tÆ° liá»‡u sáº£n xuáº¥t Ä‘Æ°á»£c chuyá»ƒn nguyÃªn váº¹n vÃ o sáº£n pháº©m.<br>
â€¢ <strong>v</strong> â€“ tÆ° báº£n kháº£ biáº¿n (variable capital): giÃ¡ trá»‹ sá»©c lao Ä‘á»™ng, tráº£ dÆ°á»›i dáº¡ng tiá»n lÆ°Æ¡ng.<br>
â€¢ <strong>m</strong> â€“ giÃ¡ trá»‹ tháº·ng dÆ° (surplus value): pháº§n giÃ¡ trá»‹ má»›i do lao Ä‘á»™ng táº¡o ra vÆ°á»£t trÃªn v.<br><br>

<strong>ğŸ”¹ QuÃ¡ trÃ¬nh sáº£n xuáº¥t GTTD:</strong><br>
Trong sáº£n xuáº¥t tÆ° báº£n chá»§ nghÄ©a, lao Ä‘á»™ng cá»§a cÃ´ng nhÃ¢n chia thÃ nh:<br>
â€¢ <em>Thá»i gian lao Ä‘á»™ng táº¥t yáº¿u (tâ‚):</em> táº¡o ra giÃ¡ trá»‹ tÆ°Æ¡ng Ä‘Æ°Æ¡ng tiá»n lÆ°Æ¡ng (v).<br>
â€¢ <em>Thá»i gian lao Ä‘á»™ng tháº·ng dÆ° (tâ‚‚):</em> táº¡o ra giÃ¡ trá»‹ tháº·ng dÆ° (m).<br>
â†’ CÃ´ng thá»©c cÆ¡ báº£n: <strong>m = tâ‚‚ / tâ‚ Ã— v</strong><br>
â†’ Tá»· suáº¥t giÃ¡ trá»‹ tháº·ng dÆ°: <strong>mâ€™ = m / v Ã— 100%</strong><br><br>

<strong>ğŸ”¹ Báº£n cháº¥t:</strong><br>
â€¢ GTTD khÃ´ng pháº£i do tÆ° báº£n sinh ra, mÃ  do lao Ä‘á»™ng sá»‘ng táº¡o ra.<br>
â€¢ Lao Ä‘á»™ng lÃ  hÃ ng hoÃ¡ Ä‘áº·c biá»‡t: giÃ¡ trá»‹ sá»­ dá»¥ng cá»§a nÃ³ táº¡o ra giÃ¡ trá»‹ má»›i lá»›n hÆ¡n giÃ¡ trá»‹ cá»§a báº£n thÃ¢n nÃ³.<br><br>

<strong>ğŸ”¹ Ã nghÄ©a:</strong><br>
â€¢ LÃ  â€œhÃ²n Ä‘Ã¡ táº£ngâ€ cá»§a há»c thuyáº¿t kinh táº¿ chÃ­nh trá»‹ MÃ¡c.<br>
â€¢ Váº¡ch tráº§n báº£n cháº¥t bÃ³c lá»™t há»£p phÃ¡p trong quan há»‡ sáº£n xuáº¥t tÆ° báº£n chá»§ nghÄ©a.<br>
â€¢ LÃ  cÆ¡ sá»Ÿ khoa há»c cho Ä‘áº¥u tranh giai cáº¥p vÃ  lÃ½ luáº­n vá» chá»§ nghÄ©a xÃ£ há»™i.`
  },

  "3.1.3": {
    title: "3.1.3 CÃ¡c phÆ°Æ¡ng phÃ¡p sáº£n xuáº¥t giÃ¡ trá»‹ tháº·ng dÆ°",
    text: `
<strong>ğŸ”¹ 1. GiÃ¡ trá»‹ tháº·ng dÆ° tuyá»‡t Ä‘á»‘i:</strong><br>
Thu Ä‘Æ°á»£c báº±ng cÃ¡ch kÃ©o dÃ i ngÃ y lao Ä‘á»™ng vÆ°á»£t quÃ¡ thá»i gian lao Ä‘á»™ng táº¥t yáº¿u (tâ‚).<br>
â€¢ NgÃ y lao Ä‘á»™ng = tâ‚ + tâ‚‚<br>
â€¢ Khi kÃ©o dÃ i tâ‚‚ â‡’ mâ†‘, mâ€™â†‘ (tá»· suáº¥t GTTD tÄƒng).<br>
VÃ­ dá»¥: Lao Ä‘á»™ng 8h â†’ 10h/ngÃ y, náº¿u 4h Ä‘áº§u lÃ  tâ‚ thÃ¬ tâ‚‚ tÄƒng tá»« 4h â†’ 6h â‡’ mâ€™ = 6/4 Ã— 100% = 150%.<br>
<em>Giá»›i háº¡n:</em> Bá»‹ rÃ ng buá»™c bá»Ÿi sá»©c khá»e, Ä‘iá»u kiá»‡n xÃ£ há»™i, luáº­t lao Ä‘á»™ng.<br><br>

<strong>ğŸ”¹ 2. GiÃ¡ trá»‹ tháº·ng dÆ° tÆ°Æ¡ng Ä‘á»‘i:</strong><br>
Thu Ä‘Æ°á»£c báº±ng cÃ¡ch rÃºt ngáº¯n thá»i gian lao Ä‘á»™ng táº¥t yáº¿u (tâ‚), trong khi tá»•ng thá»i gian lao Ä‘á»™ng khÃ´ng Ä‘á»•i.<br>
â€¢ CÆ¡ cháº¿: tÄƒng nÄƒng suáº¥t lao Ä‘á»™ng xÃ£ há»™i â†’ háº¡ giÃ¡ trá»‹ tÆ° liá»‡u sinh hoáº¡t â†’ giáº£m giÃ¡ trá»‹ sá»©c lao Ä‘á»™ng.<br>
â€¢ Káº¿t quáº£: tâ‚ giáº£m, tâ‚‚ tÄƒng â‡’ mâ€™â†‘.<br>
VÃ­ dá»¥: NgÃ y lao Ä‘á»™ng 8h, tâ‚ giáº£m tá»« 4h â†’ 3h â‡’ tâ‚‚ tÄƒng tá»« 4h â†’ 5h â‡’ mâ€™ = 5/3 Ã— 100% â‰ˆ 166%.<br><br>

<strong>ğŸ”¹ 3. GiÃ¡ trá»‹ tháº·ng dÆ° siÃªu ngáº¡ch:</strong><br>
Do doanh nghiá»‡p cÃ¡ biá»‡t cÃ³ nÄƒng suáº¥t lao Ä‘á»™ng cao hÆ¡n má»©c xÃ£ há»™i trung bÃ¬nh.<br>
â€¢ <em>Äiá»u kiá»‡n:</em> GiÃ¡ trá»‹ cÃ¡ biá»‡t (wáµ¢) < GiÃ¡ trá»‹ xÃ£ há»™i (wâ‚›).<br>
â€¢ GTTD siÃªu ngáº¡ch = wâ‚› â€“ wáµ¢.<br>
VÃ­ dá»¥: Sáº£n xuáº¥t 1 sáº£n pháº©m cÃ³ giÃ¡ trá»‹ xÃ£ há»™i 100, nhÆ°ng doanh nghiá»‡p cÃ¡ biá»‡t chá»‰ cáº§n 80 â†’ GTTD siÃªu ngáº¡ch = 20.<br><br>

<strong>ğŸ”¹ Ã nghÄ©a:</strong><br>
Ba phÆ°Æ¡ng phÃ¡p Ä‘á»u lÃ  cÃ¡ch thá»©c tÆ° báº£n gia tÄƒng bÃ³c lá»™t lao Ä‘á»™ng, nhÆ°ng GTTD tÆ°Æ¡ng Ä‘á»‘i vÃ  siÃªu ngáº¡ch lÃ  Ä‘á»™ng lá»±c máº¡nh nháº¥t thÃºc Ä‘áº©y tiáº¿n bá»™ ká»¹ thuáº­t vÃ  cáº¡nh tranh trong TBCN.`
  },

  "3.2": {
    title: "3.2 TÃ­ch lÅ©y tÆ° báº£n",
    text: `
<strong>ğŸ”¹ KhÃ¡i niá»‡m:</strong><br>
TÃ­ch lÅ©y tÆ° báº£n lÃ  quÃ¡ trÃ¬nh chuyá»ƒn hoÃ¡ má»™t pháº§n giÃ¡ trá»‹ tháº·ng dÆ° (m) thÃ nh tÆ° báº£n má»›i (Î”C), nháº±m má»Ÿ rá»™ng quy mÃ´ sáº£n xuáº¥t.<br>
<em>Biá»ƒu thá»©c:</em> TB' = c + v + m â†’ TB'' = c + Î”c + v + Î”v<br><br>

<strong>ğŸ”¹ Quy mÃ´ tÃ­ch lÅ©y phá»¥ thuá»™c:</strong><br>
1. Tá»· suáº¥t giÃ¡ trá»‹ tháº·ng dÆ° (mâ€™) â€“ cÃ ng cao, tÃ­ch lÅ©y cÃ ng lá»›n.<br>
2. NÄƒng suáº¥t lao Ä‘á»™ng xÃ£ há»™i â€“ cÃ ng cao, chi phÃ­ sáº£n xuáº¥t cÃ ng giáº£m.<br>
3. ChÃªnh lá»‡ch giá»¯a tÆ° báº£n báº¥t biáº¿n vÃ  kháº£ biáº¿n (c/v).<br><br>

<strong>ğŸ”¹ Há»‡ quáº£:</strong><br>
â€¢ Cáº¥u táº¡o há»¯u cÆ¡ tÆ° báº£n tÄƒng: c/v â†‘ â†’ mÃ¡y mÃ³c thay tháº¿ lao Ä‘á»™ng sá»‘ng.<br>
â€¢ TÃ­ch tá»¥ tÆ° báº£n (má»™t doanh nghiá»‡p ngÃ y cÃ ng lá»›n) vÃ  táº­p trung tÆ° báº£n (nhiá»u tÆ° báº£n nhá» há»£p nháº¥t).<br>
â€¢ PhÃ¢n hoÃ¡ xÃ£ há»™i: má»™t cá»±c tÃ­ch lÅ©y tÃ i sáº£n, má»™t cá»±c tÃ­ch lÅ©y nghÃ¨o Ä‘Ã³i.<br>
â€¢ HÃ¬nh thÃ nh â€œquÃ¢n dá»± bá»‹ cÃ´ng nghiá»‡pâ€ â€“ lá»±c lÆ°á»£ng lao Ä‘á»™ng tháº¥t nghiá»‡p thÆ°á»ng trá»±c.<br><br>

<strong>ğŸ”¹ CÃ´ng thá»©c MÃ¡c mÃ´ táº£:</strong><br>
Î”C = m Ã— a<br>
â†’ Trong Ä‘Ã³ <em>a</em> lÃ  tá»· lá»‡ tÃ¡i Ä‘áº§u tÆ° cá»§a giÃ¡ trá»‹ tháº·ng dÆ°.<br>
Náº¿u m = 100, a = 0.6 â†’ Î”C = 60 â†’ 60% giÃ¡ trá»‹ tháº·ng dÆ° dÃ¹ng Ä‘á»ƒ má»Ÿ rá»™ng sáº£n xuáº¥t.<br><br>

<strong>ğŸ”¹ Ã nghÄ©a:</strong><br>
TÃ­ch lÅ©y tÆ° báº£n pháº£n Ã¡nh Ä‘á»™ng lá»±c ná»™i táº¡i cá»§a TBCN, Ä‘á»“ng thá»i cÅ©ng lÃ  nguyÃªn nhÃ¢n sÃ¢u xa cá»§a báº¥t bÃ¬nh Ä‘áº³ng xÃ£ há»™i.`
  },

  "3.3": {
    title: "3.3 CÃ¡c hÃ¬nh thá»©c biá»ƒu hiá»‡n cá»§a giÃ¡ trá»‹ tháº·ng dÆ°",
    text: `
<strong>ğŸ”¹ 1. Lá»£i nhuáº­n (p):</strong><br>
<em>CÃ´ng thá»©c:</em> p = G â€“ k = m<br>
â€¢ Chi phÃ­ sáº£n xuáº¥t (k) = c + v.<br>
â€¢ Tá»· suáº¥t lá»£i nhuáº­n: pâ€™ = p / (c + v) Ã— 100%.<br>
â€¢ Lá»£i nhuáº­n bÃ¬nh quÃ¢n (P): hÃ¬nh thÃ nh qua cáº¡nh tranh giá»¯a cÃ¡c ngÃ nh, dáº«n Ä‘áº¿n <em>tá»· suáº¥t lá»£i nhuáº­n bÃ¬nh quÃ¢n</em>.<br><br>

<strong>ğŸ”¹ 2. Lá»£i tá»©c (Z):</strong><br>
Pháº§n lá»£i nhuáº­n bÃ¬nh quÃ¢n tráº£ cho ngÆ°á»i cho vay vá»‘n.<br>
â€¢ Tá»· suáº¥t lá»£i tá»©c: Zâ€™ = Z / (TBCV) Ã— 100%.<br>
â†’ Lá»£i tá»©c pháº£n Ã¡nh sá»± phÃ¢n chia GTTD giá»¯a nhÃ  tÆ° báº£n cÃ´ng nghiá»‡p vÃ  tÆ° báº£n cho vay.<br><br>

<strong>ğŸ”¹ 3. Äá»‹a tÃ´ tÆ° báº£n chá»§ nghÄ©a:</strong><br>
Pháº§n lá»£i nhuáº­n siÃªu ngáº¡ch cÃ²n láº¡i sau khi tráº£ lá»£i nhuáº­n bÃ¬nh quÃ¢n cho Ä‘á»‹a chá»§.<br>
â€¢ <em>Äá»‹a tÃ´ chÃªnh lá»‡ch I:</em> do khÃ¡c biá»‡t tá»± nhiÃªn vá» Ä‘á»™ mÃ u má»¡, vá»‹ trÃ­ Ä‘áº¥t.<br>
â€¢ <em>Äá»‹a tÃ´ chÃªnh lá»‡ch II:</em> do Ä‘áº§u tÆ° thÃ¢m canh tÄƒng nÄƒng suáº¥t.<br>
â€¢ <em>Äá»‹a tÃ´ tuyá»‡t Ä‘á»‘i:</em> do cháº¿ Ä‘á»™ tÆ° há»¯u ruá»™ng Ä‘áº¥t táº¡o ra.<br><br>

<strong>ğŸ”¹ 4. Biá»ƒu hiá»‡n hiá»‡n Ä‘áº¡i:</strong><br>
Trong thá»i Ä‘áº¡i ká»¹ thuáº­t sá»‘, giÃ¡ trá»‹ tháº·ng dÆ° biá»ƒu hiá»‡n dÆ°á»›i hÃ¬nh thá»©c:<br>
â€¢ â€œData rentâ€: giÃ¡ trá»‹ thu Ä‘Æ°á»£c tá»« dá»¯ liá»‡u ngÆ°á»i dÃ¹ng (Facebook, Google).<br>
â€¢ â€œPlatform rentâ€: pháº§n trÄƒm hoa há»“ng cÃ¡c ná»n táº£ng nhÆ° Uber, AppStore.<br>
â€¢ â€œAlgorithm rentâ€: lá»£i Ã­ch tá»« thuáº­t toÃ¡n Ä‘á»™c quyá»n (AI, big data).<br><br>

<strong>ğŸ”¹ Ã nghÄ©a:</strong><br>
CÃ¡c hÃ¬nh thá»©c lá»£i nhuáº­n â€“ lá»£i tá»©c â€“ Ä‘á»‹a tÃ´ che giáº¥u nguá»“n gá»‘c lao Ä‘á»™ng cá»§a GTTD, lÃ m cho bÃ³c lá»™t trá»Ÿ nÃªn â€œvÃ´ hÃ¬nhâ€ nhÆ°ng sÃ¢u sáº¯c hÆ¡n.`
  },

  "vietnam": {
    title: "Thá»±c tiá»…n táº¡i Viá»‡t Nam qua lÄƒng kÃ­nh MÃ¡c â€“ LÃªnin",
    text: `
<strong>ğŸ”¹ 1. GTTD trong doanh nghiá»‡p FDI:</strong><br>
CÃ´ng nhÃ¢n Samsung, Foxconn, PouYuen lÃ m 8h/ngÃ y, lÆ°Æ¡ng ~8â€“10 triá»‡u/thÃ¡ng, nhÆ°ng táº¡o ra sáº£n pháº©m trá»‹ giÃ¡ hÃ ng trÄƒm triá»‡u Ä‘á»“ng.<br>
â†’ Pháº§n chÃªnh lá»‡ch Ä‘Ã³ chÃ­nh lÃ  giÃ¡ trá»‹ tháº·ng dÆ° bá»‹ chiáº¿m Ä‘oáº¡t.<br><br>

<strong>ğŸ”¹ 2. TÃ­ch lÅ©y tÆ° báº£n á»Ÿ Viá»‡t Nam:</strong><br>
â€¢ TÃ­ch lÅ©y chá»§ yáº¿u thÃ´ng qua tÃ¡i Ä‘áº§u tÆ° FDI: hÆ¡n 70% lá»£i nhuáº­n Ä‘Æ°á»£c tÃ¡i Ä‘áº§u tÆ°.<br>
â€¢ Cáº¥u táº¡o há»¯u cÆ¡ tÄƒng nhanh trong cÃ¡c ngÃ nh cÃ´ng nghiá»‡p â€“ mÃ¡y mÃ³c thay tháº¿ lao Ä‘á»™ng phá»• thÃ´ng.<br>
â€¢ Há»‡ quáº£: báº¥t bÃ¬nh Ä‘áº³ng thu nháº­p, chÃªnh lá»‡ch vÃ¹ng miá»n, hÃ¬nh thÃ nh táº§ng lá»›p â€œtÆ° sáº£n má»›iâ€.<br><br>

<strong>ğŸ”¹ 3. HÃ¬nh thá»©c biá»ƒu hiá»‡n má»›i:</strong><br>
â€¢ Lá»£i nhuáº­n siÃªu ngáº¡ch trong ngÃ nh cÃ´ng nghá»‡ (FPT, VNG, VinFast).<br>
â€¢ â€œÄá»‹a tÃ´ ká»¹ thuáº­t sá»‘â€ thÃ´ng qua dá»¯ liá»‡u ngÆ°á»i dÃ¹ng vÃ  báº£n quyá»n pháº§n má»m.<br>
â€¢ TÃ­ch tá»¥ tÆ° báº£n trong báº¥t Ä‘á»™ng sáº£n, tÃ i chÃ­nh, ná»n táº£ng sá»‘.<br><br>

<strong>ğŸ”¹ 4. Äá»‹nh hÆ°á»›ng kháº¯c phá»¥c:</strong><br>
â€¢ NÃ¢ng cao giÃ¡ trá»‹ sá»©c lao Ä‘á»™ng: tÄƒng lÆ°Æ¡ng tá»‘i thiá»ƒu, phÃ¡t triá»ƒn cÃ´ng Ä‘oÃ n Ä‘á»™c láº­p.<br>
â€¢ NhÃ  nÆ°á»›c Ä‘iá»u tiáº¿t báº±ng thuáº¿ lÅ©y tiáº¿n, chÃ­nh sÃ¡ch phÃºc lá»£i xÃ£ há»™i.<br>
â€¢ HÆ°á»›ng tá»›i ná»n kinh táº¿ thá»‹ trÆ°á»ng <em>Ä‘á»‹nh hÆ°á»›ng xÃ£ há»™i chá»§ nghÄ©a</em>, báº£o Ä‘áº£m hÃ i hÃ²a giá»¯a tÄƒng trÆ°á»Ÿng vÃ  cÃ´ng báº±ng.`
  }

};


function appendMessage(role, text){
  const wrap = document.createElement('div');
  wrap.className = 'msg ' + role;
  const b = document.createElement('div');
  b.className = 'bubble';
  b.innerHTML = text;
  wrap.appendChild(b);
  document.getElementById('view').appendChild(wrap);
  document.getElementById('view').scrollTop = 9999;
}

async function handleQuestion(q){
  if(!q.trim()) return;
  appendMessage('user', q);
  document.getElementById('user-input').value = '';

  const lower = q.toLowerCase();
  let kbKey = null;
  if(lower.includes('giÃ¡ trá»‹ tháº·ng dÆ°')) kbKey = "3.1";
  else if(lower.includes('phÆ°Æ¡ng phÃ¡p')) kbKey = "3.1.3";
  else if(lower.includes('tÃ­ch lÅ©y')) kbKey = "3.2";
  else if(lower.includes('hÃ¬nh thá»©c')) kbKey = "3.3";
  else if(lower.includes('viá»‡t nam')) kbKey = "vietnam";

  if(kbKey){
    appendMessage('ai', `<strong>${KNOWLEDGE_BASE[kbKey].title}</strong><br>${KNOWLEDGE_BASE[kbKey].text}`);
  } else {
    appendMessage('ai', "Äang phÃ¢n tÃ­ch sÃ¢u...");
    try {
      const resp = await fetch("https://api.openai.com/v1/chat/completions", {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          "Authorization":"Bearer " + OPENAI_API_KEY
        },
        body: JSON.stringify({
          model:"gpt-4o-mini",
          messages:[
            {role:"system", content:"Báº¡n lÃ  trá»£ lÃ½ triáº¿t há»c MÃ¡câ€“LÃªnin, tráº£ lá»i tiáº¿ng Viá»‡t, phong cÃ¡ch há»c thuáº­t sÃ¢u, biá»‡n chá»©ng, cÃ³ vÃ­ dá»¥ vÃ  káº¿t luáº­n."},
            {role:"user", content:q}
          ]
        })
      });
      const data = await resp.json();
      const msg = data?.choices?.[0]?.message?.content || "KhÃ´ng cÃ³ pháº£n há»“i tá»« API.";
      appendMessage('ai', msg.replace(/\n/g,'<br>'));
    } catch(e){
      appendMessage('ai', "â— Lá»—i khi gá»i OpenAI API: " + e.message);
    }
  }
}

document.getElementById('send').addEventListener('click',()=>handleQuestion(document.getElementById('user-input').value));
document.getElementById('user-input').addEventListener('keypress',e=>{
  if(e.key==='Enter' && !e.shiftKey){e.preventDefault();handleQuestion(e.target.value);}
});

// render topics
const topicsEl = document.getElementById('topics');
Object.values(KNOWLEDGE_BASE).forEach(k=>{
  const d=document.createElement('div');
  d.className='topic';
  d.innerHTML=`<strong>${k.title}</strong><br><span style="font-size:13px">${k.text.slice(0,80)}...</span>`;
  d.onclick=()=>handleQuestion(k.title);
  topicsEl.appendChild(d);
});
</script>
</body>
</html>
